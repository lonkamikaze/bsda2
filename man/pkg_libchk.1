.Dd 23 February, 2021
.Dt PKG_LIBCHK 1
.Os
.Sh NAME
.Nm pkg_libchk
.Nd check packages for links against missing libraries
.Sh SYNOPSIS
.Nm
.Op Fl cmnoqv
.Op Fl j Ar jobs
.Op Fl a
.Nm
.Op Fl CcdgimnOoqrvx
.Op Fl j Ar jobs
.Ar pkg-name ...
.Nm
.Fl h
.Sh DESCRIPTION
The
.Nm
script uses
.Xr pkg-info 8 ,
.Xr ldd 1
and
.Xr readelf 1
to check whether a package is linked against missing libraries or libraries
residing in %%PREFIX%%/lib/compat and its subfolders.
.Sh OPTIONS
The following options are available:
.Bl -tag -width indent
.It Fl a -all
Check all packages. This is the default action in case no
.Ar pkg-name
has been specified.
.It Fl C -case-sensitive
See
.Xr pkg-info 8 .
.It Fl c -clean
Create clean output without status messages.
.It Fl d -dependencies
Also operate on the dependencies of the provided
.Ar pkg-name .
.It Fl g -glob
See
.Xr pkg-info 8 .
.It Fl h -help
Displays the available options.
.It Fl i -case-insensitive
See
.Xr pkg-info 8 .
.It Fl j Ar jobs Fl -jobs Ar jobs
Specify the amount of parallel
.Ar jobs
the script will attempt run. The default is number of detected cores
plus one.
.It Fl m -no-filter
In this mode all the checks to detect false positives are turned off.
.Pp
It also causes indirect dependencies to be listed as missing dependencies.
.It Fl n -no-compat
This deactivates detecting compat libraries in %%PREFIX%%/lib/compat
as missing libraries.
.It Fl O -by-origin
See
.Xr pkg-info 8 .
.It Fl o -origin
Instead of the package name the package origin is printed.
.It Fl q -quiet
Only print the names of affected packages. Do not print any details. This
option is meant for machine readability.
.Pp
This option cannot be combined with verbose output.
.It Fl r -required-by
Also check packages that depend on the provided
.Ar packages .
This is a good idea when checking for the effects of a library update.
.It Fl v -verbose
Be verbose about missing dependencies. Instead of rejecting indirect
dependencies print them.
.Pp
This option cannot be combined with quiet output.
.It Fl x -regex
See
.Xr pkg-info 8 .
.It Ar pkg-name
Packages are package names or shell glob patterns matching these. Whatever
works with
.Xr pkg-info 8
is an acceptable package.
.El
.Sh EXAMPLES
To check all your packages run:
.Bd -literal -offset indent
pkg_libchk
.Ed
.Pp
To create plain output for everything connected to gtk.
.Bd -literal -offset indent
pkg_libchk -q \\*gtk\\*
.Ed
.Pp
After upgrading a library, in this case icu, you can check all depending
packages:
.Bd -literal -offset indent
pkg_libchk -r icu
.Ed
.Sh EXIT CODES
.Bl -tag -width indent
.It 1
The script has terminated because it received SIGHUP, SIGINT or SIGTERM.
.It 2
An unknown parameter has been supplied.
.It 3
The incompatible parameters
.Fl v
and
.Fl q
have been supplied.
.It 4
The parameter
.Fl j
has been supplied without an acceptable number.
.El
.Sh SEE ALSO
.Xr pkg-info 8 ,
.Xr ldd 1 ,
.Xr readelf 1 ,
.Xr hier 7
.Sh HISTORY
The
.Nm
script first appeared in the
.Sy bsdadminscripts-4.0
collection. It was rewritten
for the
.Sy bsda2
collection.
.Sh AUTHORS
.An Dominic Fandrey Aq Mt freebsd@k4m1.org
